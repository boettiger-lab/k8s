# This file can update the JupyterHub Helm chart's default configuration values.
#
# For reference see the configuration reference and default values, but make
# sure to refer to the Helm chart version of interest to you!
#
# Introduction to YAML:     https://www.youtube.com/watch?v=cdLNKUoMc6c
# Chart config reference:   https://zero-to-jupyterhub.readthedocs.io/en/stable/resources/reference.html
# Chart default values:     https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/HEAD/jupyterhub/values.yaml
# Available chart versions: https://hub.jupyter.org/helm-chart/
ingress:
  enabled: true
proxy:
  service:
    type: NodePort
singleuser:
  profileList:
    - display_name: "Pangeo"
      slug: pangeo
      description: Pangeo 
      profile_options: &profile_options
        resource_allocation: &profile_options_resource_allocation
          display_name: Resource Allocation
          choices:
            small:
              display_name: Small (1.9 GB RAM)
              kubespawner_override:
                mem_guarantee: 1991341312
                mem_limit: 1991341312
              default: true
              med:
              display_name: Medium (14.8 GB RAM)
              kubespawner_override:
                mem_guarantee: 15930730496
                mem_limit: 15930730496
            large:
              display_name: Large (29.7 GB RAM)
              kubespawner_override:
                mem_guarantee: 31861460992
                mem_limit: 31861460992
      kubespawner_override:
        image: pangeo/pytorch-notebook 
    - display_name: "CPU"
      slug: rocker
      description: R environment with many geospatial libraries pre-installed
      profile_options: 
        resource_allocation: 
          display_name: Resource Allocation
          choices:
            small:
              display_name: Small (1.9 GB RAM)
              kubespawner_override:
                mem_guarantee: 1991341312
                mem_limit: 1991341312
              default: true
              med:
              display_name: Medium (14.8 GB RAM)
              kubespawner_override:
                mem_guarantee: 15930730496
                mem_limit: 15930730496
            large:
              display_name: Large (29.7 GB RAM)
              kubespawner_override:
                mem_guarantee: 31861460992
                mem_limit: 31861460992
      kubespawner_override:
        image: ghcr.io/boettiger-lab/k8s-gpu:latest
        default_url: /lab # change to /rstudio to go straight to RStudio
        working_dir: /home/rstudio
    - display_name: "GPU"
      slug: gpu 
      description: Jupyter + R environment with many geospatial libraries pre-installed
      profile_options:
        resource_allocation:
          display_name: Resource Allocation
          choices:
            gpu-small:
              display_name: Small (2 GB RAM)
              kubespawner_override:
                mem_guarantee: 1991341312
                mem_limit: 1991341312
                extra_resource_limits:
                  nvidia.com/gpu: "1"
            gpu-med:
              display_name: Medium (14.8 GB RAM)
              kubespawner_override:
                mem_guarantee: 15930730496
                mem_limit: 15930730496
                extra_resource_limits:
                  nvidia.com/gpu: "1"
            gpu-large:
              display_name: Large (29.7 GB RAM)
              kubespawner_override:
                mem_guarantee: 31861460992
                mem_limit: 31861460992
                extra_resource_limits:
                  nvidia.com/gpu: "1"
      kubespawner_override:
        image: ghcr.io/boettiger-lab/k8s-gpu:latest
        default_url: /lab # change to /rstudio to go straight to RStudio
        working_dir: /home/rstudio
    - display_name: "Bring your own image"
      description: Specify your own docker image (must have python and jupyterhub installed in it)
      slug: custom
      profile_options:
        image:
          display_name: Image
          unlisted_choice:
            enabled: True
            display_name: "Custom image"
            validation_regex: "^.+:.+$"
            validation_message: "Must be a publicly available docker image, of form <image-name>:<tag>"
            kubespawner_override:
              image: "{value}"
          choices: {}
hub:
  config:
    # Shared settings. we don't need nvidia to be default
    KubeSpawner:
      extra_pod_config:
        runtimeClassName: "nvidia"
    Authenticator:
      admin_users:
        - cboettig 
    GitHubOAuthenticator:
      allowed_organizations:
        - espm-288 
      scope:
        - read:org
      oauth_callback_url: https://jupyterhub.thelio.carlboettiger.info/hub/oauth_callback
    JupyterHub:
      authenticator_class: github

